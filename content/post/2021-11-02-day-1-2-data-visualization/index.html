---
title: "Day 1.2 Data visualization"
subtitle: "Customized Data Visualization in `ggplot2`"
date: '2021-11-02'
output: 
  blogdown::html_page:
    df_print: tibble
    toc: true
    number_sections: TRUE
  
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>

<div id="TOC">
<ul>
<li><a href="#topics"><span class="toc-section-number">0.1</span> Topics</a></li>
<li><a href="#citations-and-data"><span class="toc-section-number">1</span> Citations and data</a>
<ul>
<li><a href="#r-packages"><span class="toc-section-number">1.1</span> R packages</a></li>
<li><a href="#lizard-size-measurement-data"><span class="toc-section-number">1.2</span> Lizard size measurement data</a></li>
<li><a href="#jornada-vegetation-spatial-data"><span class="toc-section-number">1.3</span> Jornada vegetation spatial data</a></li>
</ul></li>
<li><a href="#set-up"><span class="toc-section-number">2</span> Set-up</a>
<ul>
<li><a href="#get-workshop-materials"><span class="toc-section-number">2.1</span> Get workshop materials</a></li>
<li><a href="#create-a-new-r-markdown-document-or-r-script"><span class="toc-section-number">2.2</span> Create a new R Markdown document or R script</a></li>
<li><a href="#attach-r-packages"><span class="toc-section-number">2.3</span> Attach R packages</a></li>
<li><a href="#read-in-the-lizard-data"><span class="toc-section-number">2.4</span> Read in the lizard data</a></li>
</ul></li>
<li><a href="#ggplot2-basics-review"><span class="toc-section-number">3</span> <code>ggplot2</code> Basics Review</a>
<ul>
<li><a href="#the-essentials"><span class="toc-section-number">3.1</span> The essentials</a></li>
<li><a href="#aesthetic-mapping"><span class="toc-section-number">3.2</span> Aesthetic mapping</a>
<ul>
<li><a href="#updating-based-on-a-constant-no-aes"><span class="toc-section-number">3.2.1</span> Updating based on a constant? NO <code>aes()</code>!</a></li>
<li><a href="#updating-an-aesthetic-based-on-a-variable-yes-aes"><span class="toc-section-number">3.2.2</span> Updating an aesthetic based on a variable? YES <code>aes()</code>!</a></li>
</ul></li>
<li><a href="#themes"><span class="toc-section-number">3.3</span> Themes</a></li>
<li><a href="#axis-labels"><span class="toc-section-number">3.4</span> Axis labels</a></li>
<li><a href="#facetting"><span class="toc-section-number">3.5</span> Facetting</a></li>
<li><a href="#getting-things-in-order"><span class="toc-section-number">3.6</span> Getting things in order</a></li>
<li><a href="#ggplot-basics-synthesis-examples"><span class="toc-section-number">3.7</span> <code>ggplot</code> basics: synthesis examples</a></li>
</ul></li>
<li><a href="#advanced-ggplot2-customization"><span class="toc-section-number">4</span> Advanced <code>ggplot2</code> customization</a>
<ul>
<li><a href="#an-unsung-hero-scales"><span class="toc-section-number">4.1</span> An unsung hero: <code>scales</code></a>
<ul>
<li><a href="#thoughtful-breaks-limits-labels"><span class="toc-section-number">4.1.1</span> Thoughtful breaks, limits &amp; labels</a></li>
<li><a href="#customized-aesthetics-with-scale_-functions"><span class="toc-section-number">4.1.2</span> Customized aesthetics with <code>scale_</code> functions</a></li>
</ul></li>
<li><a href="#in-the-weeds-of-themes-gridlines-panel-colors"><span class="toc-section-number">4.2</span> In the weeds of themes (gridlines, panel colors)</a></li>
<li><a href="#direct-annotation-and-thresholds"><span class="toc-section-number">4.3</span> Direct annotation and thresholds</a>
<ul>
<li><a href="#apply-what-weve-learned-to-something-new"><span class="toc-section-number">4.3.1</span> Apply what we’ve learned to something new!</a></li>
<li><a href="#aside-better-legends"><span class="toc-section-number">4.3.2</span> Aside: better legends</a></li>
</ul></li>
<li><a href="#repulsive-labels-e.g.-ggrepel"><span class="toc-section-number">4.4</span> Repulsive labels (e.g. <code>ggrepel</code>)</a></li>
<li><a href="#highlighting-for-clarity-e.g.-with-gghighlight"><span class="toc-section-number">4.5</span> Highlighting for clarity (e.g. with <code>gghighlight</code>)</a></li>
</ul></li>
<li><a href="#compound-figures-with-patchwork"><span class="toc-section-number">5</span> Compound figures with <code>patchwork</code></a></li>
<li><a href="#explore-some-new-graph-types"><span class="toc-section-number">6</span> Explore some new graph types</a>
<ul>
<li><a href="#marginal-plots"><span class="toc-section-number">6.1</span> Marginal plots</a></li>
<li><a href="#a-beeswarm-plot-with-ggbeeswarm"><span class="toc-section-number">6.2</span> A beeswarm plot with <code>ggbeeswarm</code></a></li>
<li><a href="#a-heatmap-with-geom_tile"><span class="toc-section-number">6.3</span> A heatmap with <code>geom_tile()</code></a></li>
<li><a href="#make-a-map"><span class="toc-section-number">6.4</span> Make a map!</a></li>
</ul></li>
<li><a href="#export-your-graphs-figures"><span class="toc-section-number">7</span> Export your graphs &amp; figures</a></li>
<li><a href="#learn-more"><span class="toc-section-number">8</span> Learn more</a>
<ul>
<li><a href="#books"><span class="toc-section-number">8.1</span> Books</a></li>
<li><a href="#ggplot2-tutorials-and-examples"><span class="toc-section-number">8.2</span> <code>ggplot2</code> tutorials and examples</a></li>
<li><a href="#data-viz-inspiration"><span class="toc-section-number">8.3</span> Data viz inspiration</a></li>
</ul></li>
</ul>
</div>

<p><strong>Allison Horst, PhD</strong></p>
<p>Assistant Teaching Professor, Bren School, UC Santa Barbara</p>
<ul>
<li><a href="mailto:ahorst@ucsb.edu" class="email">ahorst@ucsb.edu</a></li>
<li><a href="https://twitter.com/allison_horst">@allison_horst</a></li>
</ul>
<div id="topics" class="section level2" number="0.1">
<h2><span class="header-section-number">0.1</span> Topics</h2>
<ul>
<li>Conceptual hierarchy of data viz</li>
<li><code>ggplot2</code> basics review
<ul>
<li>Aesthetic mapping</li>
<li>Themes</li>
<li>Labels</li>
<li>Facets (&amp; facet grids vs facet wraps)</li>
<li>Getting things in order (e.g. fct_reorder)</li>
</ul></li>
<li>Advanced customization in <code>ggplot2</code>
<ul>
<li><code>scales</code> for thoughtful breaks and labels</li>
<li>…and color schemes (+ <code>paletteer</code>!)</li>
<li>In the weeds of themes (gridlines, panel colors, margins, etc.)</li>
<li>Direct annotation (as an alternative to legends)</li>
<li>Repulsive labels (e.g. <code>ggrepel</code>)</li>
<li>Highlighting for clarity (e.g. with <code>gghighlight</code>)</li>
</ul></li>
<li>Compound figures with <code>patchwork</code></li>
<li>A few new graph types to consider
<ul>
<li>Marginal plot</li>
<li>Beeswarm plots with <code>ggbeeswarm</code></li>
<li>Heatmaps with <code>geom_tile()</code></li>
</ul></li>
<li>Export &amp; save your graphs</li>
<li>Keep learning</li>
</ul>
</div>
<div id="citations-and-data" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Citations and data</h1>
<div id="r-packages" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> R packages</h2>
<p>Thank you to developers, sharers, teachers, and the entire R community for building things and creating resources to help us all learn. I’d especially like to thank developers &amp; maintainers for the following packages:</p>
<ul>
<li><code>tidyverse</code>: Wickham et al., (2019). Welcome to the tidyverse. Journal of
Open Source Software, 4(43), 1686,
<a href="https://doi.org/10.21105/joss.01686" class="uri">https://doi.org/10.21105/joss.01686</a></li>
<li><code>ggplot2</code>: H. Wickham. ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag New
York, 2016.</li>
<li><code>ggrepel</code>: Kamil Slowikowski (2021). ggrepel: Automatically Position Non-Overlapping Text
Labels with ‘ggplot2’. R package version 0.9.1.
<a href="https://github.com/slowkow/ggrepel" class="uri">https://github.com/slowkow/ggrepel</a></li>
<li><code>gghighlight</code>: Hiroaki Yutani (2020). gghighlight: Highlight Lines and Points in ‘ggplot2’. R
package version 0.3.1. <a href="https://github.com/yutannihilation/gghighlight/" class="uri">https://github.com/yutannihilation/gghighlight/</a></li>
<li><code>R Markdown</code>: Yihui Xie and J.J. Allaire and Garrett Grolemund (2018). R Markdown: The
Definitive Guide. Chapman and Hall/CRC. ISBN 9781138359338. URL
<a href="https://bookdown.org/yihui/rmarkdown" class="uri">https://bookdown.org/yihui/rmarkdown</a>.</li>
<li><code>sf</code>: Pebesma, E., 2018. Simple Features for R: Standardized Support for Spatial Vector
Data. The R Journal 10 (1), 439-446, <a href="https://doi.org/10.32614/RJ-2018-009" class="uri">https://doi.org/10.32614/RJ-2018-009</a></li>
<li><code>paletteer</code>: See AUTHORS file. (2021). paletteer: Comprehensive Collection of Color Palettes. R package version 1.3.0. <a href="https://github.com/EmilHvitfeldt/paletteer" class="uri">https://github.com/EmilHvitfeldt/paletteer</a></li>
<li><code>gapminder</code>: Jennifer Bryan (2017). gapminder: Data from Gapminder.
<a href="https://github.com/jennybc/gapminder" class="uri">https://github.com/jennybc/gapminder</a>, <a href="http://www.gapminder.org/data/" class="uri">http://www.gapminder.org/data/</a>,
<a href="https://doi.org/10.5281/zenodo.594018" class="uri">https://doi.org/10.5281/zenodo.594018</a>.</li>
<li><code>janitor</code>:Sam Firke (2021). janitor: Simple Tools for Examining and Cleaning Dirty Data. R
package version 2.1.0. <a href="https://github.com/sfirke/janitor" class="uri">https://github.com/sfirke/janitor</a></li>
</ul>
</div>
<div id="lizard-size-measurement-data" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Lizard size measurement data</h2>
<p>Our data are a curated subset from <a href="https://lter.jornada.nmsu.edu/">Jornada Basin Long Term Ecological Research site</a> in New Mexico, part of the US Long Term Ecological Research (LTER) network:</p>
<ul>
<li>Lightfoot, D. and W.G. Whitford. 2020. Lizard pitfall trap data from 11 NPP study locations at the Jornada Basin LTER site, 1989-2006 ver 37. Environmental Data Initiative. <a href="https://doi.org/10.6073/pasta/4a6e258fb49c31e222ecbbcfd128967f" class="uri">https://doi.org/10.6073/pasta/4a6e258fb49c31e222ecbbcfd128967f</a></li>
</ul>
<p>From the data package: “This data package contains data on lizards sampled by pitfall traps located at 11 consumer plots at Jornada Basin LTER site from 1989-2006. The objective of this study is to observe how shifts in vegetation resulting from desertification processes in the Chihuahaun desert have changed the spatial and temporal availability of resources for consumers. Desertification changes in the Jornada Basin include changes from grass to shrub dominated communities and major soil changes. If grassland systems respond to rainfall without significant lags, but shrub systems do not, then consumer species should reflect these differences. In addition, shifts from grassland to shrubland results in greater structural heterogeneity of the habitats. We hypothesized that consumer populations, diversity, and densities of some consumers will be higher in grasslands than in shrublands and will be related to the NPP of the sites. Lizards were captured in pitfall traps at the 11 LTER II/III consumer plots (a subset of NPP plots) quarterly for 2 weeks per quarter. Variables measured include species, sex, recapture status, snout-vent length, total length, weight, and whether tail is broken or whole. This study is complete.”</p>
<p>There are 16 total variables in the <code>lizards.csv</code> data we’ll read in. The ones we’ll use in this workshop are:</p>
<ul>
<li><code>date</code>: data collection date</li>
<li><code>scientific_name</code>: lizard scientific name</li>
<li><code>common_name</code>: lizard common name</li>
<li><code>site</code>: research site code</li>
<li><code>sex</code>: lizard sex (m = male; f = female; j = juvenile)</li>
<li><code>sv_length</code>: snout-vent length (millimeters)</li>
<li><code>total_length</code>: body length (millimeters)</li>
<li><code>toe_num</code>: toe mark number</li>
<li><code>weight</code>: body weight (grams)</li>
<li><code>tail</code>: tail condition (b = broken; w = whole)</li>
</ul>
</div>
<div id="jornada-vegetation-spatial-data" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> Jornada vegetation spatial data</h2>
<p>From <a href="https://lter.jornada.nmsu.edu/spatial-data/">Jornada Basin LTER Spatial Data</a>: Dominant Vegetation of the JER and CDRRC in 1998 (Download KMZ 3972 KB) Dominant and subdominant vegetation on the Jornada Experimental Range and Chihuahuan Desert Rangeland Research Center in 1998. Published in Gibbens, R. P., McNeely, R. P., Havstad, K. M., Beck, R. F., &amp; Nolen, B. (2005). Vegetation changes in the Jornada Basin from 1858 to 1998. Journal of Arid Environments, 61(4), 651-668.</p>
</div>
</div>
<div id="set-up" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Set-up</h1>
<div id="get-workshop-materials" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Get workshop materials</h2>
<p>You can get the workshop materials in two ways:</p>
<ol style="list-style-type: decimal">
<li>Clone the workshop repo from GitHub to work locally</li>
<li>Create an RStudio Cloud account, and click <a href="https://rstudio.cloud/project/2181259">HERE</a> to get to the project. Make sure you click on ‘Make permanent copy’ so your updates &amp; notes will be stored.</li>
</ol>
</div>
<div id="create-a-new-r-markdown-document-or-r-script" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Create a new R Markdown document or R script</h2>
<p>Allison will be working in R Markdown, but you can follow along in either an .Rmd or R script.</p>
</div>
<div id="attach-r-packages" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Attach R packages</h2>
<pre class="r"><code># General use packages:
library(tidyverse)
library(here)
library(janitor)

# Specifically for plots:
library(patchwork)
library(ggrepel)
library(gghighlight)
library(paletteer)
library(ggExtra)
library(ggbeeswarm)

# And for another dataset we&#39;ll explore:
library(gapminder)

# Spatial
library(sf)</code></pre>
</div>
<div id="read-in-the-lizard-data" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Read in the lizard data</h2>
<pre class="r"><code>lizards &lt;- read_csv(&quot;lizards.csv&quot;)</code></pre>
</div>
</div>
<div id="ggplot2-basics-review" class="section level1" number="3">
<h1><span class="header-section-number">3</span> <code>ggplot2</code> Basics Review</h1>
<p>First, we’ll cover some <code>ggplot2</code> basics to create the foundation that we’ll make our great customized data visualization on.</p>
<div id="the-essentials" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> The essentials</h2>
<p>When we start creating a <code>ggplot</code> graph, we need three basic building blocks:</p>
<ol style="list-style-type: decimal">
<li>We’re using <code>ggplot</code></li>
<li>What data we want to use in our graph</li>
<li>What type of graph we’re creating</li>
</ol>
<p>For example:</p>
<pre class="r"><code># ggplot essential pieces, 3 ways (that do the same thing):

# Like this: 
ggplot(data = lizards, aes(x = total_length, y = weight)) + # That&#39;s 1 &amp; 2
  geom_point() # That&#39;s 3

# Or, alternatively:
ggplot(data = lizards) +
  geom_point(aes(x = total_length, y = weight))

# Or another way:
ggplot() +
  geom_point(data = lizards, aes(x = total_length, y = weight))</code></pre>
<p>Which all produce the same thing:</p>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Which makes changing graph types straightforward by updating the <code>geom_</code>:</p>
<pre class="r"><code>ggplot(data = lizards, aes(x = total_length, y = weight)) +
  geom_line() # Bad idea, just demonstrating a geom switch.</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>Keep in mind that some graph types only require one variable - for example, <code>geom_histogram</code>:</p>
<pre class="r"><code>ggplot(data = lizards, aes(x = total_length)) +
  geom_histogram()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>And remember to carefully consider the <em>type</em> of data you’re trying to visualize, which will help to direct the graph type. For example, a jitterplot usually has one categorical variable and one continuous variable:</p>
<pre class="r"><code>ggplot(data = lizards, aes(y = common_name, x = weight)) +
  geom_jitter()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p><strong>Not sure which type of graph is appropriate for your data?</strong> My favorite resource is Yan Holtz’ <a href="https://www.data-to-viz.com/">From Data to Viz</a> - check it out, it is fun and amazing, and links to code examples from the <a href="https://www.r-graph-gallery.com/">R Graph Gallery</a>.</p>
</div>
<div id="aesthetic-mapping" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Aesthetic mapping</h2>
<div id="updating-based-on-a-constant-no-aes" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Updating based on a constant? NO <code>aes()</code>!</h3>
<p>To change aesthetics of a graph based on a constant (e.g. “Make all the points BLUE”), we can add the information directly to the relevant <code>geom_</code> layer. Some things to keep in mind:</p>
<ul>
<li><code>fill</code>: updates fill colors (e.g. column, density, violin, &amp; boxplot interior fill color)</li>
<li><code>color</code>: updates point &amp; border line colors (generally)</li>
<li><code>shape</code>: update point style</li>
<li><code>alpha</code>: update transparency (0 = transparent, 1 = opaque)</li>
<li><code>size</code>: point size or line width</li>
<li><code>linetype</code>: update the line type (e.g. “dotted”, “dashed”, “dotdash”, etc.)</li>
</ul>
<p>If you are updating these by referring to a constant value, they <strong>should not be within an <code>aes()</code></strong>.</p>
<p>For example, let’s make some nightmares:</p>
<pre class="r"><code>ggplot(data = lizards, aes(x = weight)) +
  geom_histogram(color = &quot;orange&quot;, 
                 fill = &quot;purple&quot;, 
                 size = 2, 
                 linetype = &quot;dotted&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Some shapes have both a fill and color aesthetic:</p>
<pre class="r"><code>ggplot(data = lizards, aes(x = total_length, y = weight)) +
  geom_point(color = &quot;cyan4&quot;, 
             fill = &quot;yellow&quot;,
             shape = 22, 
             size = 3, 
             alpha = 0.4)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>
<div id="updating-an-aesthetic-based-on-a-variable-yes-aes" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Updating an aesthetic based on a variable? YES <code>aes()</code>!</h3>
<p>If you want to map a variable onto a graph aesthetic (e.g., point color should be based on <em>lizard species</em>), put it within <code>aes()</code>.</p>
<pre class="r"><code>ggplot(data = lizards, aes(x = total_length, y = weight)) +
  geom_point(aes(color = common_name, size = total_length))</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>These can be used in combination. For example, if we want the color to be based on species, but the transparency for all points is 0.3:</p>
<pre class="r"><code>ggplot(data = lizards, aes(x = total_length, y = weight)) +
  geom_point(aes(color = common_name), alpha = 0.3)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
</div>
</div>
<div id="themes" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Themes</h2>
<p>Quick reminder: yeah there are some built-in themes you can add with <code>+ theme_*()</code>.</p>
<p>A few useful baselines are:</p>
<ul>
<li><code>theme_minimal()</code>: minimal theme</li>
<li><code>theme_bw()</code>: also pretty good for some stuff</li>
<li><code>theme_light()</code>: a nice light one</li>
</ul>
<pre class="r"><code>ggplot(data = lizards, aes(x = site, y = weight)) +
  geom_jitter(aes(color = common_name)) +
  theme_minimal()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
</div>
<div id="axis-labels" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Axis labels</h2>
<p>For basic axis labels, I recommend <code>labs()</code>:</p>
<pre class="r"><code>ggplot(data = lizards, aes(x = total_length, y = weight)) +
  geom_point() +
  labs(x = &quot;Total length (mm)&quot;,
       y = &quot;Weight (grams)&quot;,
       title = &quot;Lizard size&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>We’ll learn a few more advanced label skills later on.</p>
</div>
<div id="facetting" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Facetting</h2>
<p>Sometimes it’s useful to split up information in a graph into separate panels. For example, maybe we want to have a separate graph of total length versus weight for <em>each lizard species</em>. That would be really tedious to create them all manually from subsets. Instead, we’ll facet by distinct groups within a variable.</p>
<p>We’ll learn two ways to do this:</p>
<ul>
<li><code>facet_wrap()</code>: the one where you give it one faceting variable and the panels get wrapped into a grid</li>
<li><code>facet_grid()</code>: the one where you make a grid based on row &amp; column faceting variables</li>
</ul>
<p>For example, let’s say we just want each species to have its own panel. Then we can use <code>facet_wrap()</code>:</p>
<pre class="r"><code>ggplot(data = lizards, aes(x = total_length, y = weight)) +
  geom_point() +
  facet_wrap(~common_name, ncol = 3, scales = &quot;free&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>But what if we want to make a grid where the panels are split across groups by lizard sex and if it has a broken tail or not? Since we have two variables being used to create our grid, we’ll use <code>facet_grid()</code>:</p>
<pre class="r"><code>ggplot(data = lizards, aes(x = total_length, y = weight)) +
  geom_point() +
  facet_grid(sex ~ tail)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
</div>
<div id="getting-things-in-order" class="section level2" number="3.6">
<h2><span class="header-section-number">3.6</span> Getting things in order</h2>
<p><code>ggplot</code> loves putting things in alphabetical order - but that’s rarely the order you actually want things in if you have categorical groups. Let’s find some total counts of lizards in the dataset by common name, then make a column graph:</p>
<pre class="r"><code>lizard_counts &lt;- lizards %&gt;% 
  count(common_name)

ggplot(data = lizard_counts, aes(y = fct_reorder(common_name, n), x = n)) +
  geom_col()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
</div>
<div id="ggplot-basics-synthesis-examples" class="section level2" number="3.7">
<h2><span class="header-section-number">3.7</span> <code>ggplot</code> basics: synthesis examples</h2>
<p><strong>Example 1:</strong> A quick review of basics, including:</p>
<ul>
<li><code>ggplot</code> essentials</li>
<li>aesthetic mapping</li>
<li>themes</li>
<li><code>facet_wrap</code> &amp; <code>facet_grid</code></li>
<li>labels with <code>labs</code></li>
</ul>
<pre class="r"><code>ggplot(data = lizards, aes(x = total_length, y = weight)) +
  geom_point(aes(color = common_name, shape = common_name), 
             fill = &quot;black&quot;,
             size = 2) +
  theme_minimal() +
  labs(x = &quot;Total length (mm)&quot;,
       y = &quot;Weight (g)&quot;,
       color = &quot;Lizard species&quot;) +
  facet_wrap(~common_name, scales = &quot;free&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p><strong>Example 2:</strong> Reminders of position, <code>facet_grid</code>, and factor reordering</p>
<p>Let’s make a stacked column graph of lizard species by site:</p>
<pre class="r"><code>ggplot(data = lizards, aes(y = fct_infreq(common_name))) +
  geom_bar(aes(fill = site)) +
  theme_bw() +
  labs(x = &quot;Lizard counts&quot;,
       y = &quot;Species (common name)&quot;) +
  facet_grid(sex ~ tail)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<pre class="r"><code># That annoying space below zero? Let&#39;s keep that in mind...</code></pre>
</div>
</div>
<div id="advanced-ggplot2-customization" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Advanced <code>ggplot2</code> customization</h1>
<div id="an-unsung-hero-scales" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> An unsung hero: <code>scales</code></h2>
<p>The <a href="https://scales.r-lib.org/index.html"><code>scales</code></a> package in R is truly an unsung hero of finalizing <code>ggplot</code> graphs. To hear more, I strongly recommend watching Dana Seidel’s 20 minute talk on <a href="https://rstudio.com/resources/rstudioconf-2020/the-little-package-that-could-taking-visualizations-to-the-next-level-with-the-scales-package/"><em>The little package that could: Taking visualizations to the next level with the scales package</em></a> from rstudio::conf(2020).</p>
<p>Why does that matter to us? <em>Because a whole lot of the subtle things that make a graph way better are updating using the scales suite of helpful functions.</em></p>
<p>For a complete list of scales functions &amp; usage, see: <a href="https://scales.r-lib.org/index.html" class="uri">https://scales.r-lib.org/index.html</a></p>
<div id="thoughtful-breaks-limits-labels" class="section level3" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Thoughtful breaks, limits &amp; labels</h3>
<p>Little things make a big difference in data visualization. Just like we should take great care to make axis labels useful and complete, we also need to think about how values are communicated for our different variables.</p>
<p>In 2-D data visualization, that means customizing your breaks, limits, &amp; tick mark labels &amp; formatting. From Hadley Wickham &amp; Dana Seidel: “The most common use of the <code>scales</code> package is to control the appearance of axis and legend labels. Use a <code>break_</code> function to control how breaks are generated from the limits, and a <code>label_</code> function to control how breaks are turned in to labels.”</p>
<p>Let’s explore some different ways to update breaks and labels.</p>
<div id="updating-breaks-labels" class="section level4" number="4.1.1.1">
<h4><span class="header-section-number">4.1.1.1</span> Updating breaks &amp; labels</h4>
<p>The important thing: know <em>what type of variable you have on each axis</em> so that you know what <code>scale_</code> version to call. For example:</p>
<ul>
<li>For dates: <code>scale_*_date()</code></li>
<li>For continuous variables: <code>scale_*_continuous()</code></li>
<li>For discrete variables: <code>scale_*_discrete()</code></li>
</ul>
<p>Within those layers added to your plot, you can update the <code>breaks =</code>, <code>limits =</code>, <code>labels =</code> and <code>expand =</code>options.</p>
<pre class="r"><code>ggplot(data = lizards, aes(x = total_length, y = weight)) +
  geom_point()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data = lizards, aes(x = total_length, y = weight)) +
  geom_point() +
  scale_x_continuous(breaks = c(0, 250, 500), 
                     limits = c(0, 500)) +
  scale_y_continuous(breaks = seq(from = 0, to = 70, by = 10), 
                     limits = c(0, 70)) +
  theme_light()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-19-2.png" width="672" /></p>
<p>But you can also do so much more! For example, you can convert to a log scale:</p>
<pre class="r"><code>ggplot(data = lizards, aes(x = total_length, y = weight)) +
  geom_point() +
  scale_x_log10()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>And it is really nice for formatting axis dates. Let’s make a version of the data with lizard counts by date to try a few things:</p>
<pre class="r"><code>lizard_counts &lt;- lizards %&gt;% 
  mutate(date = lubridate::mdy(date)) %&gt;% 
  count(date)

ggplot(data = lizard_counts, aes(x = date, y = n)) +
  geom_line() +
  scale_x_date(breaks = scales::breaks_width(&quot;3 years&quot;), # See date_breaks for next year!
               labels = scales::label_date(&quot;&#39;%y&quot;)) + # See date_labels for next year!
  scale_y_log10(labels = scales::label_scientific())</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data = lizard_counts, aes(x = date, y = n)) +
  geom_line() +
  scale_x_date(breaks = scales::breaks_pretty())</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-21-2.png" width="672" /></p>
<p>Explore the different options for <code>label_*</code> that appear once you start typing it in…you’ll see a bunch of different options. Make your tick marks currencies, scientific notation, or more - just by updating the labels within the correct <code>scale_</code>! Go ahead &amp; try it out, it’s pretty amazing (and see the many different label options here: <a href="https://scales.r-lib.org/reference/index.html" class="uri">https://scales.r-lib.org/reference/index.html</a>).</p>
</div>
</div>
<div id="customized-aesthetics-with-scale_-functions" class="section level3" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Customized aesthetics with <code>scale_</code> functions</h3>
<p>We’ve learned to use <code>scales</code> functions to update breaks and labels. It is also useful for updating aesthetics, for example to customize color gradients, set size bins, and more.</p>
<p>Again, it is very important to know <strong>what aesthetic you are trying to update.</strong></p>
<p>For example, is it a <strong>fill</strong> aesthetic you’re hoping to customize? Then you might use <code>scale_fill_*()</code>. But if it is a <strong>color</strong> aesthetic, you’d use <code>scale_color_*()</code> functions. If it is the transparency, then <code>scale_alpha_*()</code>. If it is the shape, then <code>scale_shape_*()</code>. So make sure you know <em>which aesthetic you are hoping to change with scales!</em></p>
<pre class="r"><code>ggplot(data = lizards, aes(x = total_length, y = weight)) +
  geom_point(aes(color = weight)) +
  scale_color_gradient(low = &quot;red&quot;, high = &quot;navy&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<pre class="r"><code># Or have more than 2 colors in your gradient: 
ggplot(data = lizards, aes(x = total_length, y = weight)) +
  geom_point(aes(color = weight)) +
  scale_color_gradientn(colors = c(&quot;orange&quot;, &quot;red&quot;, &quot;purple&quot;, &quot;navy&quot;, &quot;black&quot;))</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-22-2.png" width="672" /></p>
<pre class="r"><code># Or use a palette from paletteer! 
# Check out options: https://emilhvitfeldt.github.io/paletteer/

# ggplot(data = lizards, aes(x = total_length, y = weight)) +
#   geom_point(aes(color = weight)) +
#   scale_color_paletteer_c(&quot;scico::oslo&quot;)

# See more continuous palettes with View(palettes_c_names)</code></pre>
<p>There are also great options for <em>binning</em> colors for a continuous variable, including with the <code>scale_*_steps()</code> functions (see more: <a href="https://ggplot2.tidyverse.org/reference/scale_steps.html" class="uri">https://ggplot2.tidyverse.org/reference/scale_steps.html</a>). For example, maybe in the graph above we want binned (instead of continuous gradient) color values:</p>
<pre class="r"><code>ggplot(data = lizards, aes(x = total_length, y = weight)) +
  geom_point(aes(color = weight)) +
  scale_color_steps(low = &quot;red&quot;, high = &quot;black&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<pre class="r"><code># Notice the binned legend - within bins all points are the same value. 
# Use n.breaks =  or breaks = c() to manually set the break number or value.</code></pre>
<p>You can create a divergent binned scheme with <code>scale_*_steps2()</code>:</p>
<pre class="r"><code>ggplot(data = lizards, aes(x = total_length, y = weight)) +
  geom_point(aes(color = total_length)) +
  scale_color_steps2(low = &quot;green&quot;,
                     mid = &quot;black&quot;,
                     high = &quot;red&quot;,
                     midpoint = 150,
                     breaks = c(50, 75, 150, 180, 220, 280))</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>Or, to make your own bins, try <code>scale_*_stepsn()</code>:</p>
<pre class="r"><code>ggplot(data = lizards, aes(x = total_length, y = weight)) +
  geom_point(aes(color = weight)) +
  scale_color_stepsn(colors = c(&quot;orange&quot;,&quot;red&quot;,&quot;purple&quot;),
                     breaks = seq(from = 10, to = 60, by = 10))</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>What if we have a discrete variable? Let’s make a boxplot of lizard lengths by species, then customize the fill color with a palette in <code>paletteer</code>:</p>
<pre class="r"><code>ggplot(data = lizards, aes(x = common_name, y = total_length)) +
  geom_boxplot(aes(fill = common_name), color = &quot;black&quot;, show.legend = FALSE) +
  theme_minimal() +
  coord_flip()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<pre class="r"><code># But **order matters**, so let&#39;s make an ordered version: 

lizards_mean &lt;- lizards %&gt;% 
  mutate(common_name = fct_reorder(common_name, total_length, .fun = median))

# Then make a graph (use View(palettes_d_names) to see other discrete palettes in {paletteer})

ggplot(data = lizards_mean, aes(y = common_name, x = total_length)) +
  geom_boxplot(aes(fill = common_name), show.legend = FALSE) +
  scale_x_continuous(limits = c(0, 500)) +
  scale_fill_paletteer_d(palette = &quot;ggsci::default_gsea&quot;) +
  labs(y = &quot;Lizard species&quot;,
       x = &quot;Total length (mm)&quot;) +
  theme_minimal()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-26-2.png" width="672" /></p>
<p>Cool let’s try another one: Find counts of lizard by species, reorder factor levels by count, update aesthetic by color (removing redundant legend), customize color using something from <code>paletteer</code>:</p>
<pre class="r"><code>lizard_n &lt;- lizards %&gt;% 
  count(common_name) %&gt;% 
  mutate(common_name = fct_reorder(common_name, n))

ggplot(data = lizard_n, aes(y = common_name, x = n)) +
  geom_col(aes(fill = common_name), show.legend = FALSE) +
  scale_fill_paletteer_d(&quot;tidyquant::tq_dark&quot;) +
  scale_x_continuous(expand = c(0,0), limits = c(0, 1200)) +
  theme_bw() +
  labs(x = &quot;Common name&quot;, 
       y = &quot;Total count&quot;) +
  theme(axis.title.y = element_text(angle = 0, vjust = 0.5))</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
</div>
</div>
<div id="in-the-weeds-of-themes-gridlines-panel-colors" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> In the weeds of themes (gridlines, panel colors)</h2>
<p>Ask yourself: do you need those gridlines? Only if your audience needs to know whether values are above or below meaningful values - which can be useful, but oftentimes gridlines are really overused and make an entire plot feel more cluttered.</p>
<p>We can update gridline frequency by changing breaks, but we may want to customize them in other ways, too.</p>
<pre class="r"><code>p &lt;- ggplot(data = lizards, aes(x = total_length, y = weight)) +
  geom_point()

p + 
  theme(panel.grid = element_blank()) # removes all gridlines (major &amp; minor)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<pre class="r"><code>p + 
  theme(panel.grid.minor = element_blank(),
        panel.grid.major = element_line(color = &quot;red&quot;))</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-28-2.png" width="672" /></p>
<pre class="r"><code># Now let&#39;s just go bananas with some theme stuff: 

p + 
  theme(panel.background = element_rect(color = &quot;purple&quot;, size = 3, fill = &quot;yellow&quot;),
        panel.grid.major.y = element_line(color = &quot;orange&quot;),
        panel.grid.major.x = element_blank(),
        axis.text.x = element_text(color = &quot;blue&quot;),
        axis.text.y = element_text(color = &quot;cyan&quot;),
        axis.title.x = element_text(color = &quot;green&quot;),
        axis.title.y = element_text(color = &quot;gray70&quot;),
        text = element_text(size = 12, family=&quot;serif&quot;),
        plot.background = element_rect(fill = &quot;pink&quot;))</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-28-3.png" width="672" /></p>
<pre class="r"><code># Watch Kara Woo&#39;s talk from RStudio Conference 2021!</code></pre>
</div>
<div id="direct-annotation-and-thresholds" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Direct annotation and thresholds</h2>
<p>Legends are hard for audiences. Aligning values with important thresholds described in a figure captions is hard for audiences. It’s not always possible, but depending on your presentation and the audience, consider adding direct annotation and thresholds to plots.</p>
<p>We’ll do that with a few little tools:</p>
<ul>
<li><code>annotate()</code>: add annotation manually by location</li>
<li><code>geom_hline()</code>: add a horizontal line</li>
<li><code>geom_vline()</code>: add a vertical line</li>
</ul>
<pre class="r"><code>p +
  annotate(&quot;text&quot;, x = 100, y = 50, label = &quot;COOL!&quot;, color = &quot;purple&quot;) +
  annotate(&quot;text&quot;, x = 400, y = 25, label = &quot;WHOA.&quot;, color = &quot;red&quot;) +
  geom_hline(yintercept = 40, linetype = &quot;dotted&quot;, color = &quot;blue&quot;) +
  geom_vline(xintercept = 20, linetype = &quot;dashed&quot;, color = &quot;green&quot;) +
  theme_minimal()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<pre class="r"><code># Or, have the value be determined based on a variable: 
p +
  geom_hline(yintercept = mean(lizards$weight), linetype = &quot;dashed&quot;, color = &quot;red&quot;) +
  annotate(&quot;text&quot;, x = 350, y = mean(lizards$weight) + 2, label = &quot;Mean weight&quot;, color = &quot;red&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-29-2.png" width="672" /></p>
<div id="apply-what-weve-learned-to-something-new" class="section level3" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Apply what we’ve learned to something new!</h3>
<p>This data is from the <a href="http://monobasinresearch.org/">Mono Basin Clearinghouse</a>, and contains lake level (feet above sea level) for Mono Lake - a terminal saline lake in eastern California.</p>
<p>Here are some important things to know when considering how to make our data viz:</p>
<ul>
<li>LA Department of Water &amp; Power took water unrestricted from streams feeding into Mono Lake starting in 1941</li>
<li>Unrestricted water diversions continued until the landmark 1983 California Supreme Court decision, led by the Mono Lake Committee, that “The public trust … is an affirmation of the duty of the state to protect the people’s common heritage of streams, lakes, marshlands and tidelands…”</li>
<li>From <em>The Mono Basin Ecosystem: Effects of Changing Lake Level, published in 1987 by the Mono Basin Ecosystem Study Committee, Board on Environmental Studies and Toxicology</em>: “If the lake fell to levels at which the birds’ food sources were adversely affected, the bird populations would be reduced. The decrease in availability of brine shrimp for food would begin to affect those birds relying on them – eared grebes and California gulls – at a salinity of 120 g/L (lake level of 6360 ft).”</li>
</ul>
<pre class="r"><code># Read in the data: 
mono &lt;- read_csv(&quot;mono.csv&quot;)</code></pre>
<pre class="r"><code>ggplot(data = mono, aes(x = year, y = lake_level)) +
  geom_rect(aes(xmin = 1941, 
                xmax = 1983, 
                ymin = 6350, 
                ymax = 6440), 
            fill = &quot;gray90&quot;) +
  geom_line() +
  labs(x = &quot;\nYear&quot;,
       y = &quot;Lake surface level\n(feet above sea level)\n&quot;,
       title = &quot;Mono Lake levels (1850 - 2017)\n&quot;,
       caption = &quot;Data: Mono Basin Clearinghouse&quot;) +
  scale_x_continuous(limits = c(1850, 2020), 
                     expand = c(0,0),
                     breaks = seq(1850, 2010, by = 20)) +
  scale_y_continuous(limits = c(6350, 6440), 
                     breaks = c(6370, 6400, 6430),
                     expand = c(0,0), 
                     labels = scales::label_comma()) +
  annotate(&quot;text&quot;, x = 1962, y = 6425, 
           label = &quot;unrestricted diversions\n(1941 - 1983)&quot;,
           size = 3) +
  theme_light() +
  theme(plot.title.position = &quot;plot&quot;,
        axis.text.y = element_text(face = &quot;italic&quot;)) +
  geom_hline(yintercept = 6360, linetype = &quot;dashed&quot;) +
  annotate(&quot;text&quot;, 
           x = 1910, 
           y = 6367, 
           label = &quot;Decreased shrimp abundance expected\n(6,360 feet above sea level)&quot;,
           size = 3)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
</div>
<div id="aside-better-legends" class="section level3" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Aside: better legends</h3>
<pre class="r"><code>two_lizards &lt;- lizards %&gt;% 
  filter(common_name %in% c(&quot;eastern fence&quot;, &quot;western whiptail&quot;))

ggplot(data = two_lizards, aes(x = total_length, y = weight)) +
  geom_point(aes(color = common_name,
                 shape = common_name),
             size = 2) +
  scale_color_manual(name = &quot;Lizard species:&quot;,
                       values = c(&quot;orange&quot;, &quot;navy&quot;),
                     labels = c(&quot;Eastern fence lizard&quot;, &quot;Western whiptail&quot;)) +
  scale_shape_discrete(name = &quot;Lizard species:&quot;,
                       labels = c(&quot;Eastern fence lizard&quot;, &quot;Western whiptail&quot;)) +
  theme_minimal() +
  theme(legend.position = c(0.2, 0.8),
        legend.background = element_blank()) # And check out other legend.* options...it&#39;s a lot.</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
</div>
</div>
<div id="repulsive-labels-e.g.-ggrepel" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Repulsive labels (e.g. <code>ggrepel</code>)</h2>
<p>Direct labeling with a bunch of groups is challenging - <code>ggrepel</code> is here to help! It makes automatic repulsive labels. Let’s make a subset of Western Whiptails at the “sand” site, then add repulsive labels by toe number.</p>
<pre class="r"><code>wwc_lizards &lt;- lizards %&gt;% 
  filter(common_name ==&quot;western whiptail&quot;, site == &quot;sand&quot;)

ggplot(data = wwc_lizards, aes(x = total_length, y = weight)) +
  geom_point() +
  geom_text_repel(aes(label = toe_num), size = 3, max.overlaps = 20, show.legend = FALSE) </code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<p>Let’s try it with a different dataset, <code>gapminder</code> (“Excerpt of the Gapminder data on life expectancy, GDP per capita, and population by country.”)</p>
<pre class="r"><code>gapminder %&gt;% 
  filter(year == 2002, continent == &quot;Europe&quot;) %&gt;% 
  ggplot(aes(x = gdpPercap, y = lifeExp)) +
  geom_point() + 
  geom_text_repel(aes(label = country), size = 3)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
</div>
<div id="highlighting-for-clarity-e.g.-with-gghighlight" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> Highlighting for clarity (e.g. with <code>gghighlight</code>)</h2>
<p>This can be particularly useful if you have made a bunch of observations or series, and you want to highlight some to make your audience’s life easier.</p>
<p>Add <code>gghighlight()</code> to your <code>ggplot</code> to specify highlighting conditions.</p>
<pre class="r"><code>p +
  gghighlight(toe_num == 250, label_key = toe_num)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<pre class="r"><code>p + 
  aes(color = site) + # Best to include this in geom_ line instead of here...
  gghighlight(site %in% c(&quot;cali&quot;, &quot;grav&quot;))</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-35-2.png" width="672" /></p>
<pre class="r"><code># One more example: 
q &lt;- ggplot(data = lizards, aes(x = total_length, y = weight, group = common_name)) +
  geom_line(aes(color = common_name)) +
  gghighlight(max(weight, na.rm = TRUE) &gt; 30)

q</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-35-3.png" width="672" /></p>
</div>
</div>
<div id="compound-figures-with-patchwork" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Compound figures with <code>patchwork</code></h1>
<p>Patchwork makes it easier to put multiple figures together into a single graphic – and to do some efficient theming while you’re at it.</p>
<p>Let’s store a couple of different graphs (we already have <code>p</code> and <code>q</code> stored):</p>
<pre class="r"><code>(p | q) &amp; # &amp; means it&#39;s applied to both plots! 
  theme_minimal()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<pre class="r"><code>z &lt;- ggplot(data = lizards, aes(y = site, x = weight)) +
  geom_boxplot(aes(fill = site), show.legend = FALSE)

# Put them all together using PEMDAS structure
((p | q) / z) &amp; theme_dark() </code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-36-2.png" width="672" /></p>
</div>
<div id="explore-some-new-graph-types" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Explore some new graph types</h1>
<div id="marginal-plots" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Marginal plots</h2>
<pre class="r"><code>whiptails &lt;- lizards %&gt;% 
  filter(common_name == &quot;western whiptail&quot;) %&gt;% 
  drop_na(total_length, weight)

# An issue with rug plots: 
ggplot(data = whiptails, aes(x = total_length, y = weight)) +
  geom_point() +
  geom_rug()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<pre class="r"><code>p &lt;- ggplot(data = whiptails, aes(x = total_length, y = weight)) +
  geom_point(aes(color = sex), size = 2) +
  theme_minimal() +
  scale_color_manual(values = c(&quot;cyan4&quot;, &quot;black&quot;, &quot;goldenrod&quot;),
                     name = &quot;Sex:&quot;, 
                     labels = c(&quot;female&quot;, &quot;juvenile&quot;, &quot;male&quot;)
  ) +
  theme(legend.position = &quot;bottom&quot;) + 
  labs(x = &quot;Total length (mm)&quot;, 
       y = &quot;Weight (grams)&quot;)

# Example 1: A histogram
# ggMarginal(p, type = &quot;histogram&quot;, fill = &quot;gray60&quot;, color = NA)

# Example 2: A boxplot, grouped by sex (as in the plot)
ggMarginal(p, type = &quot;boxplot&quot;, groupColour = TRUE)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
</div>
<div id="a-beeswarm-plot-with-ggbeeswarm" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> A beeswarm plot with <code>ggbeeswarm</code></h2>
<pre class="r"><code>ggplot(data = whiptails, aes(x = sex, y = weight)) +
  geom_beeswarm(size = 1) +
  geom_boxplot(fill = NA) +
  scale_x_discrete(labels = c(&quot;female&quot;,&quot;juvenile&quot;,&quot;male&quot;)) +
  theme_minimal()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
</div>
<div id="a-heatmap-with-geom_tile" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> A heatmap with <code>geom_tile()</code></h2>
<p>Heatmaps are a great way to see trends across groups. Here, we’ll create one to visualize lizard counts by species and site.</p>
<pre class="r"><code># Get the counts: 
lizard_counts &lt;- lizards %&gt;% 
  mutate(date = lubridate::mdy(date)) %&gt;% 
  count(year = lubridate::year(date), common_name) %&gt;% 
  drop_na()

# Make a heatmap of counts:
ggplot(data = lizard_counts, aes(x = year, y = common_name)) +
  geom_tile(aes(fill = n), show.legend = FALSE) +
  geom_text(aes(label = n), color = &quot;white&quot;, size = 3) +
  scale_fill_gradientn(colors = c(&quot;navy&quot;,&quot;red&quot;,&quot;orange&quot;)) +
  theme_minimal() +
  labs(x = &quot;Year&quot;, y = &quot;Lizard common name&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
</div>
<div id="make-a-map" class="section level2" number="6.4">
<h2><span class="header-section-number">6.4</span> Make a map!</h2>
<p>Let’s make a map using some of the skills we’ve learned to customize our ggplots:</p>
<pre class="r"><code># First, read in the Jornada Basin vegetation data: 
jornada_veg &lt;- read_sf(&quot;spatial_vegetation/doc.kml&quot;) %&gt;% dplyr::select(Name) %&gt;% 
  clean_names()

# Initial exploratory plot (one plot per attribute)
# plot(jornada_veg)

# Remember, you can see the paletteer palettes with: 
# View(palettes_c_names)
# View(palettes_d_names)

ggplot() +
  geom_sf(data = jornada_veg, 
          aes(fill = name),
          color = NA) +
  theme_minimal() +
  scale_fill_paletteer_d(palette = &quot;ggthemes::manyeys&quot;) +
  labs(x = &quot;Longitude&quot;,
       y = &quot;Latitude&quot;,
       fill = &quot;Dominant vegetation:&quot;,
       title = &quot;Jornada Basin vegetation&quot;,
       caption = &quot;Data source: Jornada Basin LTER&quot;) +
  theme(legend.position = &quot;right&quot;,
        plot.title.position = &quot;plot&quot;,
        plot.caption.position = &quot;plot&quot;,
        plot.caption = element_text(face = &quot;italic&quot;, color = &quot;gray30&quot;),
        axis.text = element_text(size = 5))</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<pre class="r"><code># For next year: how would you change increments of lat / lon on x &amp; y axis? See coord_map()</code></pre>
</div>
</div>
<div id="export-your-graphs-figures" class="section level1" number="7">
<h1><span class="header-section-number">7</span> Export your graphs &amp; figures</h1>
<p>Use <code>ggsave()</code> to export your figures, setting the dimensions, dpi, and more. The default in <code>ggsave()</code> is to save “the last plot that you displayed, using the size of the current graphics device.”</p>
<p>See <code>?ggsave</code> for documentation.</p>
<pre class="r"><code>ggsave(filename = &quot;file_name.png&quot;, width = 6, height = 4)</code></pre>
</div>
<div id="learn-more" class="section level1" number="8">
<h1><span class="header-section-number">8</span> Learn more</h1>
<p>Here are some of my favorite resources for building advanced data visualization tools in <code>ggplot2</code>, learning about new types of graphs, and choosing an appropriate graph type:</p>
<div id="books" class="section level2" number="8.1">
<h2><span class="header-section-number">8.1</span> Books</h2>
<ul>
<li><p>Claus Wilke’s <a href="https://clauswilke.com/dataviz/index.html"><em>Fundamentals of Data Visualization</em></a></p></li>
<li><p>Kieran Healy’s <a href="https://kieranhealy.org/publications/dataviz/"><em>Data Visualization</em></a></p></li>
</ul>
</div>
<div id="ggplot2-tutorials-and-examples" class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> <code>ggplot2</code> tutorials and examples</h2>
<ul>
<li><a href="https://twitter.com/CedScherer">Cedric Scherer</a>’s <a href="https://www.cedricscherer.com/2019/08/05/a-ggplot2-tutorial-for-beautiful-plotting-in-r/#legends">“A <code>ggplot2</code> tutorial for beautiful plotting in R”</a></li>
<li>More about <a href="https://scales.r-lib.org/"><code>scales</code></a></li>
</ul>
</div>
<div id="data-viz-inspiration" class="section level2" number="8.3">
<h2><span class="header-section-number">8.3</span> Data viz inspiration</h2>
<ul>
<li><a href="https://www.r-graph-gallery.com/">The R Graph Gallery</a> by <a href="">Yan Holtz</a></li>
<li><a href="https://www.data-to-viz.com/">From Data to Viz</a> by <a href="https://twitter.com/R_Graph_Gallery">Yan Holtz</a> and <a href="http://www.conor.fr/indexEN.html">Conor Healy</a></li>
</ul>
</div>
</div>
